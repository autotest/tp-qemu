- eject_media:
    no RHEL.3.9
    type = eject_media
    virt_test_type = qemu
    monitor_type = qmp
    pre_command += "dd if=/dev/urandom of=/tmp/orig bs=10M count=1 && dd if=/dev/urandom of=/tmp/new bs=10M count=1 && mkisofs -o /tmp/orig.iso /tmp/orig && mkisofs -o /tmp/new.iso /tmp/new;"
    umount_before_eject = yes
    umount_cmd = "for cd in `awk '{if($0 ~ /iso9660/) print $1}' /proc/mounts`;do fuser -k $cd; umount -d $cd;done"
    post_command += "rm -rf /tmp/orig.iso /tmp/new.iso /tmp/orig /tmp/new;"
    new_img_name = /tmp/new.iso
    cdrom_cd1 = /tmp/orig.iso
    # systemd add new cdrom rules in udev to prevent eject media,
    # so need to disable it before eject media test to avoid test failed for some latest guest.
    pre_cmd = "udev_cdrom=/lib/udev/rules.d/60-cdrom_id.rules; [ -f $udev_cdrom ] && "
    pre_cmd += "sed -i 's/\(.*DISK_EJECT_REQUEST.*\)/#\1/g' $udev_cdrom && "
    pre_cmd += "sed -i  's/\(.*lock-media.*\)/#\1/g' $udev_cdrom"
    post_cmd = "udev_cdrom=/lib/udev/rules.d/60-cdrom_id.rules; [ -f $udev_cdrom ] && "
    post_cmd += "sed -i 's/#\(.*DISK_EJECT_REQUEST.*\)/\1/g' $udev_cdrom  &&"
    post_cmd += "sed -i 's/#\(.*lock-media.*\)/\1/g' $udev_cdrom"

    variants:
        - force_eject:
            force_eject = yes
        - eject:
