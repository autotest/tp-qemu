- block_4k_discard:
    virt_test_type = qemu
    type = block_4k_discard
    only Linux
    data_images = "stg1"
    images += " ${data_images}"
    drive_werror = stop
    drive_rerror = stop
    force_create_image_stg1 = no
    force_remove_image_stg1 = no
    not_preprocess = yes
    get_scsi_device = yes
    image_format_stg1 = raw
    image_raw_device_stg1 = yes
    image_name_stg1 = TBD
    disk_size = 1024
    pre_command = "modprobe scsi_debug sector_size=4096 dev_size_mb=${disk_size} lbpu=1 unmap_max_blocks=256 unmap_granularity=16 && sleep 3"
    post_command = "modprobe -r scsi_debug"
    guest_io_cmd_number = 5
    dd_cmd = "dd if=/dev/zero of={0} bs=1M count=100 oflag=direct "
    lsblk_cmd = lsblk -d -o name,size,log-sec,phy-sec,disc-max,disc-gran,disc-aln,tran,alignment {0}
    host_io_cmd = "${lsblk_cmd}|egrep '${sec_size}.*${sec_size}'"
    guest_io_cmd1 = "${dd_cmd} && blkdiscard -l 512  {0}  "
    guest_io_cmd2 = "${dd_cmd} && blkdiscard -o 512 -l 512  {0} "
    guest_io_cmd3 = "${dd_cmd} && blkdiscard -o 512 -l 4096 {0} "
    guest_io_cmd4 = "${dd_cmd} && blkdiscard -l 4096  {0}"
    variants:
        - with_blk:
            serial_stg1 = stg1
            sec_size = 512
            blk_extra_params_stg1 = "serial=${serial_stg1}"
            drive_format_stg1 = virtio
            expected_results = 0 0 0 0 0
        - with_hd:
            serial_stg1 = stg1
            sec_size = 512
            blk_extra_params_stg1 = "serial=${serial_stg1}"
            drive_format_stg1 = scsi-hd
            expected_results = 0 0 0 0 0
        - with_block:
            sec_size = 4096
            drive_format_stg1 = scsi-block
            expected_results = 0 1 1 1 0
        - with_generic:
            sec_size = 4096
            drive_format_stg1 = scsi-generic
            drive_cache_stg1 = writethrough
            expected_results = 0 1 1 1 0
    guest_io_cmd0 = "${lsblk_cmd}|egrep '${sec_size}.*${sec_size}'"
