- netkvm_fastinit:
    type = netkvm_fastinit
    only Windows
    clone = yes
    cdroms += " virtio"
    backup_image_before_testing = yes
    restore_image_after_testing = yes
    login_timeout = 600
    enable_verifier = 1
    driver_verifier_enable = "verifier /standard /flags netkvm.sys ndis.sys"
    driver_verifier_query = "verifier /querysettings"
    driver_verifier_reset = "verifier /reset"
    only virtio_net
    nics_num = 27
    start_vm = no
    nics_num_checking_cmd = 'ipconfig | find /c "Ethernet adapter"'
    fastinit_name = "FastInit"
    netkvm_wmi = "WIN_UTILS:\netkvm\WMI\netkvm-wmi.cmd"
    required_virtio_win_prewhql = [0.1.280 , )
    variants:
        - queue1_size256:
            smp = 1
            queues = ${smp}
            nics_param = ",rx_queue_size=256,tx_queue_size=256"
            nic_extra_params_nic1 = ",rx_queue_size=256,tx_queue_size=256"
            # Single queue: allow reasonable variance but prevent extreme outliers
            init_alloc_threshold = 3000
            lazy_alloc_threshold = 150
            variants:
                - disable_fastinit:
                    fastinit_value = 0
                - enable_fastinit:
                    fastinit_value = 1
        - queue4_size1024:
            smp = 4
            mq = on
            queues = ${smp}
            nics_param = ",rx_queue_size=1024,tx_queue_size=256"
            nic_extra_params_nic1 = ",rx_queue_size=1024,tx_queue_size=256"
            # Multiqueue: higher thresholds due to increased complexity
            init_alloc_threshold = 5000
            lazy_alloc_threshold = 200
            variants:
                - disable_fastinit:
                    fastinit_value = 0
                - enable_fastinit:
                    fastinit_value = 1
