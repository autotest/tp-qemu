# Storage backends:
#   filesystem, iscsi_direct, ceph, nbd, gluster_direct
# The following testing scenario is covered:
#   Do incremental backup with recovered bitmap
#     The backup/snapshot images are local images(filesystem)


- blockdev_inc_backup_with_recovered_bitmap:
    only Linux
    only filesystem iscsi_direct ceph nbd gluster_direct
    start_vm = no
    qemu_force_use_drive_expression = no
    type = blockdev_inc_backup_with_recovered_bitmap
    virt_test_type = qemu
    images += " data1"
    source_images = data1
    image_backup_chain_data1 = full inc
    base_tag = data1
    snapshot_tag = snap
    node = drive_${base_tag}
    remove_image_data1 = yes
    force_create_image_data1 = yes
    full_backup_options = {"sync": "full"}
    image_chain = ${image_backup_chain_data1}
    rebase_mode = unsafe
    storage_pools = default
    storage_pool = default
    storage_type_default = directory

    image_size_data1 = 2G
    image_size_full = ${image_size_data1}
    image_size_inc = ${image_size_data1}
    image_size_snap = ${image_size_data1}
    image_format_data1 = qcow2
    image_format_full = qcow2
    image_format_inc = qcow2
    image_format_snap = qcow2
    image_name_data1 = data1
    image_name_full = full
    image_name_inc = inc
    image_name_snap = snap
    nbd:
        force_create_image_data1 = no
        nbd_port_data1 = 10822
        image_create_support_data1 = no
    iscsi_direct:
        lun_data1 = 1
