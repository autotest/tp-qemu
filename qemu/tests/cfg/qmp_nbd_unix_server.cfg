# QMP NBD server test with Unix socket:
#   - Start QEMU with QMP monitor
#   - Start NBD server with Unix socket
#   - Connect to NBD server using netcat
#   - Stop NBD server
#   - Verify QMP monitor functionality

- qmp_nbd_unix_server:
    virt_test_type = qemu
    start_vm = 'yes'
    kill_vm = 'yes'
    cmds_installed_host += ' nc'

    # QMP monitor settings
    monitor_type = qmp
    monitors = qmp1
    main_monitor = qmp1

    # NBD server settings
    nbd_unix_socket = /tmp/nbd-sock
    nbd_server_start_cmd = '{"execute":"nbd-server-start", "arguments":{"addr":{"type":"unix","data":{"path":"%s"}}}}' % nbd_unix_socket
    nbd_server_stop_cmd = '{"execute":"nbd-server-stop"}'
    nbd_connect_cmd = 'nc -U %s' % nbd_unix_socket

    # QMP quit command
    qmp_quit_cmd = '{"execute":"quit"}'

    # Expected messages
    qmp_quit_msg = 'SHUTDOWN'
    qmp_quit_reason = 'host-qmp-quit'
