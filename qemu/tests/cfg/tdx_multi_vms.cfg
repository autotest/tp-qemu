- tdx_multi_vms:
    type = tdx_multi_vms
    only Linux
    only x86_64
    only HostCpuVendor.intel
    kill_vm = yes
    login_timeout = 240
    start_vm = no
    image_snapshot = yes
    vm_secure_guest_type = tdx
    vm_secure_guest_object_options = attributes=10000000 quote-generation-socket.type=unix quote-generation-socket.path=/run/tdx-qgs/qgs.socket
    machine_type_extra_params = "kernel-irqchip=split"
    bios_path =  /usr/share/edk2/ovmf/OVMF.inteltdx.fd
    tdx_module_path = "/sys/module/kvm_intel/parameters/tdx"
    module_status = Y y 1
    tdx_guest_check = "journalctl|grep -i -w tdx"
    attestation_script = attestation.sh
    guest_dir = /home
    # workaround temporary guest_script passing by profile
    guest_cmd = "${guest_dir}/${attestation_script} ${guest_script}"
    host_script = tdx/${attestation_script}
    dcap_preset_services = "qgs mpa_registration"
    dcap_non_preset_services = "pccs"
    pccs_config_dir = /etc/pccs/
    # PCCS tokens
    pccs_user_token = redhat
    pccs_admin_token = kvmautotest
    # PCCS SSL configuration
    pccs_ssl_dir = "/etc/pccs/ssl"
    pccs_ssl_cert = "/etc/pccs/ssl/server-cert.pem"
    pccs_ssl_key = "/etc/pccs/ssl/server-key.pem"
    generate_ssl_cmd = 'openssl req -x509 -nodes -days 365 -newkey rsa:2048  -keyout ${pccs_ssl_key}  -out ${pccs_ssl_cert}  -subj "/O=Intel/OU=TDX/CN=localhost"'
    ca_trust_cert = "/etc/pki/ca-trust/source/anchors/pccs-server.crt"
    # SGX QCNL configuration
    sgx_qcnl_config_file = /etc/sgx_default_qcnl.conf
    pccs_port = 8082
    set_pccs_port = "sed -i '/pccs_url/s/8081/${pccs_port}/' ${sgx_qcnl_config_file}"
    variants:
        - single_vcpu:
            vms += " vm2"
            smp_fixed = 1
            vcpu_maxcpus=${smp_fixed}
            vcpu_cores_fixed = 1
            vcpu_threads_fixed = 1
            vcpu_sockets_fixed = 1
            mem = 4096
        - four_vms:
            vms += " vm2 vm3 vm4"
            smp = 8
        - max_vms:
            max_vms_cmd = "grep tdx /sys/fs/cgroup/misc.capacity | awk '{print $2}'"
            max_vcpu_cmd = "nproc"
