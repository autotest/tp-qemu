# Config for virtio-vga visual test
- virtio_vga_visual_test:
    only Windows
    type = virtio_vga_visual_test
    vga = virtio
    os_type = windows
    cdroms += " virtio winutils"
    login_timeout = 360
    reboot_timeout = 360
    driver_name = viogpudo
    device_name = "Red Hat VirtIO GPU DOD controller"
    device_hwid = '"PCI\VEN_1AF4&DEV_1050&SUBSYS_11001AF4&REV_01"'
    driver_test_names = 'viogpudo'
    virtio_win_media_type = iso
    devcon_dirname = "win7_"
    i386:
        devcon_dirname += "x86"
    x86_64:
        devcon_dirname += "amd64"
    devcon_path = "WIN_UTILS:\devcon\${devcon_dirname}\devcon.exe"

    # Windows guest commands
    check_driver_installed_cmd = powershell "Get-PnpDevice -FriendlyName '%s' -Status OK"
    find_inf_cmd = 'dir /b /s %s\%s.inf | findstr "\\%s\\"'
    get_driver_version_from_inf_cmd = type %s | findstr /i /r DriverVer.*=
    devcon_find_cmd = "%s find %s"
    pnputil_enum_cmd = pnputil /enum-drivers
    pnputil_enum_cmd_win2016 = pnputil -e
    pnputil_delete_cmd = pnputil /delete-driver %s /uninstall /force
    pnputil_delete_cmd_win2016 = pnputil -f %s -d
    pnputil_verify_clean_cmd = pnputil /enum-drivers | findstr /i %s
    pnputil_verify_clean_cmd_win2016 = pnputil -e | findstr /i %s
    get_winutils_drive_cmd = "wmic LogicalDisk where (VolumeName like '%s%%') get DeviceID /format:list"
    delete_file_cmd = "del %s"

    # AI verification prompts
    prompt_desktop_check = "Is the screen showing a normal, usable operating system desktop? Ignore the lack of a mouse cursor. Answer ONLY with 'YES' if it looks like a normal desktop. Answer ONLY with 'NO' if it is a black screen, blue screen of death (BSOD), graphical corruption, or boot console text."
    prompt_start_menu_check = "Is the Windows Start Menu (or an application launcher menu) visible/open on the screen? Answer ONLY with 'YES' or 'NO'."
    prompt_resolution_check = "What is the approximate screen resolution shown in this screenshot? Look at the overall display area and desktop elements. Answer with the resolution in format WIDTHxHEIGHT, for example: 1920x1080 or 1024x768. Answer ONLY with the resolution number."

    # Start menu commands
    start_menu_cmd = powershell -c "$w=New-Object -ComObject WScript.Shell;$w.SendKeys('^{ESC}')"
    close_menu_cmd = powershell -c "$w=New-Object -ComObject WScript.Shell;$w.SendKeys('{ESC}')"
    internal_screenshot_cmd = "powershell.exe -ExecutionPolicy Bypass -File %s"
    internal_screenshot_script = "WIN_UTILS:\Capture-Screen.ps1"
    use_vnc_screenshot = yes
    gvncviewer_tool_url = "http://download.eng.pek2.redhat.com/qa/rhts/lookaside/virt-test/utils/tools/gvncviewer-customize"
    vnc_host = 127.0.0.1
    vnc_display_num = 99
    vnc_display_resolution = 1920x1080
    vnc_display_depth = 24
    cmd_unrestrict_policy = Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
    variants:
        - basic_interaction:
            check_type = basic_interaction
        - shutdown_with_driver:
            check_type = shutdown_with_driver
        - reboot_with_driver:
            check_type = reboot_with_driver
        - reset_with_driver:
            check_type = reset_with_driver
        - install_driver_preinstalled:
            check_type = install_driver_preinstalled
        - install_uninstall_driver:
            check_type = install_uninstall_driver
        - upgrade_downgrade_driver:
            check_type = upgrade_downgrade_driver
            cdrom_virtio_downgrade = isos/windows/virtio-win-downgrade.iso
        - check_driver_signature_signtool:
            check_type = check_driver_signature_signtool
            signtool_path = "WIN_UTILS:\\signtool\\Signtool_amd64_HLK.exe"
            signtool_verify_cmd = "%s verify /v %s /c %s %s"
            signtool_verify_option_prewhql = "/pa"
            signtool_verify_option_whql = "/kp"
            signature_verify_timeout = 120
            win_version_map = "2016:2k16 2019:2k19 2022:2k22 2025:2k25"
            win_version_map += " Windows 10:w10 Windows 11:w11"
            signtool_success_pattern = "Number of files successfully [Vv]erified:\s*1"
            signtool_warnings_pattern = "Number of warnings:\s*0"
            signtool_errors_pattern = "Number of errors:\s*0"
            driver_verify_files = "sys inf"
        - check_driver_signature_sigverif:
            check_type = check_driver_signature_sigverif
            autoit_exe = "WIN_UTILS:\\AutoIT3_amd64.exe"
            sigverif_script = "WIN_UTILS:\\sigverif.au3"
            sigverif_cmd = "%s %s"
            sigverif_timeout = 120
        - boot_multiple_drivers:
            check_type = boot_multiple_drivers
        - install_driver_iommu:
            check_type = install_driver_iommu
        - resolution_modification_auto:
            check_type = resolution_modification_auto
        - resolution_modification_manual:
            check_type = resolution_modification_manual
            # Test resolutions (space-separated list)
            test_resolutions = 1920x1080 1024x768
            # Resolution modification commands
            get_resolution_cmd = powershell.exe -ExecutionPolicy Bypass -File %s
            set_resolution_cmd = powershell.exe -ExecutionPolicy Bypass -File %s -Width %s -Height %s
            get_resolution_script = WIN_UTILS:\Get-DisplayResolution.ps1
            set_resolution_script = WIN_UTILS:\Set-DisplayResolution.ps1
        - desktop_migration:
            check_type = desktop_migration
        - check_driver_after_guest_installer_upgrade:
            check_type = check_driver_after_guest_installer_upgrade
        - trigger_bsod_capture:
            check_type = trigger_bsod_capture
        - install_driver_during_os_install:
            check_type = install_driver_during_os_install
