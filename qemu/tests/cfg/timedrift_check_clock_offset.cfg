- check_clock_offset:
    rtc_clock = host
    rtc_base = utc
    rtc_drift = slew
    requires_root = yes
    ntp_server = "clock.redhat.com"
    ntp_cmd = "ntpdate ${ntp_server}"
    ntp_query_cmd = "ntpdate -q ${ntp_server}"
    Windows:
        ntp_cmd = "sc start w32time && ping -n 6 -w 1000 127.0.0.1>nul && w32tm /config /manualpeerlist:${ntp_server} /syncfromflags:manual /update"
        ntp_query_cmd = "w32tm /stripchart /computer:${ntp_server} /samples:1 /dataonly"
    variants:
        - with_syscall:
            type = timedrift_check_with_syscall
            start_vm = yes
            only Linux
            no JeOS
            tmp_dir = "/tmp"
            result_file = "clktest.log"
            build_cmd = "gcc -lrt ${tmp_dir}/clktest.c -o clktest"
            test_cmd = "./clktest"
            check_timeout = 300
        - when_crash:
            type = timedrift_check_when_crash
            start_vm = no
            sleep_time = 1800
            variants:
                - bsod:
                    only Windows
                    nmi_cmd = "monitor:inject-nmi"
                - hang:
                    kill_vm = yes
                    # Notes:
                    # please stop kernel crash recovery service like 'kdump' before trigger kernek panic,
                    # else guest will reboot immedicately that is unexpected in this test;
                    only Linux
                    nmi_cmd = "guest: echo '1' > /proc/sys/kernel/sysrq && echo '0' > /proc/sys/kernel/panic && service kdump stop; echo 'c' > /proc/sysrq-trigger"
        - after_load_vm:
            type = timedrift_check_after_load_vm
            start_vm = no
            gagent_name = "org.qemu.guest_agent.0"
            gagent_serial_type = virtio
            virtio_ports += " org.qemu.guest_agent.0"
            virtio_port_type_org.qemu.guest_agent.0 = "serialport"
            check_mod_cmd = "cat /sys/module/kvm/parameters/kvmclock_periodic_sync"
            stop_chronyd_cmd = "(service chronyd status | grep 'Loaded: loaded') && service chronyd stop"
            qmp_savevm_cmd = "savevm tag=sn1"
            qmp_loadvm_cmd = "loadvm tag=sn1"
            host_ntp_cmd = "ntpdate ${ntp_server}"
            qmp_rtc_reset_cmd = "rtc-reset-reinjection"
            # The expected time dirft is 3 seconds.
            expected_time_drift = 3
            # Check time drift after 10/20/30 minutes.
            sleep_time = 600
            sleep_iteration_times = 3
